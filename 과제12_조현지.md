6. 배치 정규화<br>
1) 배치 정규화<br>
배치 정규화는 하이퍼파라미터 탐색을 쉽게 만들어줄 뿐만 아니라, 신경망과 하이퍼파라미터의 상관관계를 줄여준다. 즉 더 많은 하이퍼파라미터가 잘 작동한다.<br>
<br>
로지스틱 회귀 등으로 모델을 학습시킬 때 입력 변수들을 정규화하면 <br>
누워있는 학습 등고선이 경사하강법에 적합하도록 둥근 형태로 바뀌어 학습이 빨라진다.<br>
평균을 계산 -> 입력 변수의 평균을 뺐다<br>
분산을 계산 -> 하나씩 제곱해준다<br>
<br>
은닉층에 대해 w^[3]이나 b^[3]을 빠르게 학습시킬 수 있도록 a^[2]같은 값을 정규화할 수 있나? (다음 층 입력값인 a^[2]가 w^[3]와 b^[3] 학습에 영향을 주기 때문)<br>
-> 배치 정규화가 하는 일<br>
-> a^[2]를 정규화할지 z^[2]를 정규화할지<br>
-> z^[2]를 정규화하는 것이 더 자주 쓰인다<br>
<br>
어떻게 배치 정규화를 구현하는가?<br>
신경망에서 사잇값들이 주어졌다고 할 때 은닉 유닛의 값 z^(1)부터 z^(m)까지 있다고 하자<br>
이값들에 대한 평균을 계산하고 분산을 계산한다<br>
그리고 z^(i)에 대해서 정규화를 하여 z^(i)_norm을 얻는다 -> z값에 대해 정규화를 거쳐 표준편차가 1이 되도록 만든다<br>
<br>
하지만 은닉 유닛이 항상 평균 0, 표준편차 1을 갖는 것이 좋지만은 않다<br>
그래서 대신 z~를 계산한다<br>
γ와 β는 학습과정에서 학습하는 파라미터이다. 둘을 이용하면 z~의 평균을 원하는 대로 설정할 수 있다<br>
정규화 이후 다시 선형변환하는 이유는 항상 같은 분포 값을 갖지 않게 하기 위함이다.<br>
<br>
2) 배치 정규화 적용시키기<br>
은닉층에서 두 단계로 나뉜다<br>
1. 선형결합인 z 를 계산하고, 이를 배치 정규화 시킨다<br>
2. 정규화 된 값들을 활성화 함수를 거쳐 활성화 값 a 를 얻는다<br>
<br>
배치정규화에서 사용되는 β^[1], β^[2]는 모멘텀이나 RMSprop 알고리즘에 쓰이는 하이퍼파라미터 β와 다르다<br>
<br>
딥러닝 프로그래밍 프레임워크를 사용하면 배치 정규화를 따로 구현할 필요가 없다<br>
<br>
● 훈련 집합의 미니 배치에 적용<br>
첫 번째 미니배치에 대해서 z^[1]을 계산한다<br>
z^[1]의 평균과 분산을 계산한 뒤에 평균을 빼고 표준편차로 나눠 배치 정규화를 진행한다<br>
β^[1]와 γ^[1]을 이용해서 값을 조정한다 // z~^[1]을 얻게 되고 활성화 함수를 적용해 a^[1]을 얻게 된다<br>
그리고 z^[2]를 w^[2]와 b^[2]를 이용해 계산해낸다<br>
<br>
이후 두 번째 미니배치로 이동한다<br>
<br>
선형결합 단계에서 상수항 b 는 없어진다. 그 이유는 배치 정규화 과정에서 z의 평균을 빼주면 사라지기 때문이다.<br>
<br>
3) 배치 정규화가 잘 작동하는 이유는 무엇일까?<br>
배치 정규화는 입력특성  XX  의 평균을 0, 분산을 1로 만듦으로써 학습 속도를 빠르게 한다.<br>
배치 정규화가 잘 되는 이유중 하나는 이전 층의 가중치 영향을 덜 받게 하는데 있다. 은닉층 값의 분포 변화를 줄여줘서, 입력 값의 분포를 제한하기 때문이다. 즉, 배치 정규화는 입력값이 바뀌어서 발생하는 문제를 안정화 시킨다. 앞층과 뒷층의 매개변수의 상관 관계를 줄여주기 때문에, 학습속도를 향상시킬 수 있다.<br>
배치 정규화의 또 다른 효과는 파라미터의 정규화(regularization)이다. 미니배치로 계산한 평균과 분산은 전체 데이터의 일부으로 추정한 것이기 때문에 잡음이 끼어있다.<br>
드롭아웃의 경우 은닉유닛에 확률에 따라 0 혹은 1을 곱하기 때문에 곱셈 잡음이 있다. 배치 정규화의 경우 곱셈잡음(×1/​σ)과 덧셈 잡음( +(−μ) )이 동시에 있다. 따라서 약간의 정규화 효과가 있다.<br>
은닉층에 잡음을 추가한다는 것은 이후 은닉층이 하나의 은닉 유닛에 너무 의존하지 않도록 만든다.<br>
큰 미니배치를 사용시 이 정규화 효과는 상대적으로 약해진다<br>
<br>
4) 테스트시의 배치 정규화<br>
테스트 시에는 배치가 하나이기 때문에 평균과 분산을 계산할 수 없다. 따라서, 학습시에 사용된 미니배치들의 지수 가중 이동 평균을 추정치로 사용한다.<br>











